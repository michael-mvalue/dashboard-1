"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{31280:(e,t,s)=>{s.d(t,{u:()=>l});var l=function(e){return e.JOB_INIT="job_init",e.JOB_FETCH_NEW="job_fetch_new",e.JOB_UPDATE="job_update",e.WORKER_INIT="worker_init",e.WORKER_FETCH_NEW="worker_new_fetch",e.WORKER_UPDATE="worker_update",e}({})},53999:(e,t,s)=>{s.d(t,{b:()=>l});let l=e=>e?e.charAt(0).toUpperCase()+e.slice(1):""},55753:(e,t,s)=>{s.d(t,{D:()=>r});var l=s(77635);let r=(0,l.tv)({base:"tracking-tight inline font-semibold",variants:{color:{violet:"from-[#FF1CF7] to-[#b249f8]",yellow:"from-[#FF705B] to-[#FFB457]",blue:"from-[#5EA2EF] to-[#0072F5]",cyan:"from-[#00b7fa] to-[#01cfea]",green:"from-[#6FEE8D] to-[#17c964]",pink:"from-[#FF72E1] to-[#F54C7A]",foreground:"dark:from-[#FFFFFF] dark:to-[#4B4B4B]"},size:{xs:"text-base lg:text-lg",sm:"text-3xl lg:text-4xl",md:"text-[2.3rem] lg:text-5xl leading-9",lg:"text-4xl lg:text-6xl"},fullWidth:{true:"w-full block"}},defaultVariants:{size:"md"},compoundVariants:[{color:["violet","yellow","blue","cyan","green","pink","foreground"],class:"bg-clip-text text-transparent bg-gradient-to-b"}]});(0,l.tv)({base:"w-full md:w-1/2 my-2 text-lg lg:text-xl text-default-600 block max-w-full",variants:{fullWidth:{true:"!w-full"}},defaultVariants:{fullWidth:!0}})},63463:(e,t,s)=>{s.r(t),s.d(t,{default:()=>T});var l=s(95155),r=s(30832),a=s.n(r),n=s(12115),i=s(74442),o=s(64184),c=s(52863),d=s(94161),u=s(75584),m=s(33061),h=s(56201),x=s(15354),f=s(65676),p=s(36115),g=s(41479),j=s(40400),b=s(22655),_=s(93327),w=s(93260),v=s(44289),k=s(55753),y=s(53071),S=s(59581),N=s(29911),C=s(51362),E=s(53999);function F(e){let{status:t}=e,{resolvedTheme:s}=(0,C.D)();return(0,l.jsx)("span",{className:"flex justify-center items-center",children:"running"===t?(0,l.jsx)(S.R,{className:"gap-1 text-white",color:"secondary",startContent:(0,l.jsx)(y.o,{color:"secondary",size:"sm",variant:"gradient"}),variant:"flat",children:(0,l.jsx)("span",{className:"text-violet-600",children:(0,E.b)(t)})}):"done"===t?(0,l.jsx)(S.R,{className:"gap-1 text-white",color:"success",startContent:(0,l.jsx)(N.A7C,{size:18}),variant:"dark"===s?"flat":"solid",children:(0,E.b)(t)}):(0,l.jsx)(S.R,{className:"gap-1",variant:"flat",children:(0,E.b)(t)})})}var D=s(31280);let O=s(94235).oO.wsBaseURL,W=[{key:5,label:"5"},{key:10,label:"10"},{key:20,label:"20"},{key:50,label:"50"}];function T(){let[e,t]=(0,n.useState)(!0),[s,r]=(0,n.useState)([]),[y,S]=(0,n.useState)(1),[N,C]=(0,n.useState)(0),[E,T]=(0,n.useState)(5),[B,A]=(0,n.useState)(!1),[J,R]=(0,n.useState)(""),[Y,I]=(0,n.useState)(!1),[P,M]=(0,n.useState)([]),[z,U]=(0,n.useState)(""),[L,K]=(0,n.useState)({column:"worker_id",direction:"ascending"}),H=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=new WebSocket("".concat(O,"/job"));return H.current=e,e.onopen=()=>{console.log("âœ… Job WebSocket connected"),t(!0),e.send(JSON.stringify({page:y,limit:E}))},e.onmessage=e=>{try{let{type:t,payload:s}=JSON.parse(e.data);if(t===D.u.JOB_INIT||t===D.u.JOB_FETCH_NEW){let{data:e,pagination:t}=s;if(!Array.isArray(e))throw Error("Invalid job data");r(e),S(t.currentPage),C(t.totalPages)}t===D.u.JOB_UPDATE&&r(e=>{let t=new Map(e.map(e=>[e.job_id,e])),l=[],r=[];for(let e of s)t.has(e.job_id)?r.push(e):l.unshift(e);let a=e.map(e=>r.find(t=>t.job_id===e.job_id)||e);return[...l,...a].slice(0,E)})}catch(e){console.error("Failed to parse message",e)}t(!1)},e.onerror=e=>console.error("WebSocket error:",e),e.onclose=()=>console.warn("WebSocket connection closed"),()=>e.close()},[E]);let V=(0,n.useMemo)(()=>{let{column:e,direction:t}=L;return Array.isArray(s)&&null!==s?[...s].sort((s,l)=>{let r=s[e],a=l[e];if(null==r)return"ascending"===t?1:-1;if(null==a)return"ascending"===t?-1:1;let n="string"==typeof r?r.toLowerCase():r,i="string"==typeof a?a.toLowerCase():a;return n<i?"ascending"===t?-1:1:n>i?"ascending"===t?1:-1:0}):[]},[s,L]),Q=e=>{T(parseInt(e))},X=(e,t)=>{A(!0),U(t),R(e)},q=e=>{I(!0),M(e)};(0,n.useEffect)(()=>{H.current&&H.current.readyState===WebSocket.OPEN&&(t(!0),H.current.send(JSON.stringify({page:y,limit:E})))},[y,E]);let G=(0,n.useCallback)((e,t)=>{var s,r,n,c,d,u,m,h,x;switch(t){case"file_content":return(0,l.jsx)(i.T,{color:"primary",size:"sm",variant:"flat",onPress:()=>{var t;return X(e.s3_key.split("_").slice(1).join("_"),null!=(t=e.file_content)?t:"")},children:e.s3_key.split("_").slice(1).join("_")});case"worker_id":return(0,l.jsx)("div",{children:e.worker_id});case"status":return(0,l.jsx)(F,{status:e.status});case"logs":return(0,l.jsx)(i.T,{size:"sm",variant:"flat",onPress:()=>q(e.logs),children:"Logs"});case"result":return(0,l.jsx)(l.Fragment,{children:e.result&&(0,l.jsx)(i.T,{color:"success",size:"sm",variant:"flat",children:"Result"})});case"duration":if("done"!==e.status)return"-";let f=new Date(null!=(n=null==(s=e.timestamps)?void 0:s.assigned_at)?n:0),p=new Date(null!=(c=null==(r=e.timestamps)?void 0:r.completed_at)?c:0).getTime()-f.getTime();if(isNaN(p)||p<0)return"-";let g=Math.floor(p/1e3),j=Math.floor(g/60);return"".concat(j,"m ").concat(g%60,"s");case"timestamps.created_at":return(0,l.jsx)("div",{children:a()(null==e||null==(d=e.timestamps)?void 0:d.created_at).format("MM/DD/YYYY hh:mm:ss A")});case"timestamps.assigned_at":return(0,l.jsx)("div",{children:(null==e||null==(u=e.timestamps)?void 0:u.assigned_at)!==null&&a()(null==e||null==(m=e.timestamps)?void 0:m.assigned_at).format("MM/DD/YYYY hh:mm:ss A")});case"timestamps.completed_at":return(0,l.jsx)("div",{children:(null==e||null==(h=e.timestamps)?void 0:h.completed_at)!==null&&a()(null==e||null==(x=e.timestamps)?void 0:x.completed_at).format("MM/DD/YYYY hh:mm:ss A")});default:return(0,o.fm)(e,t)}},[]);return(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)("h1",{className:(0,k.D)(),children:"Job"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 min-w-[160px]",children:[(0,l.jsx)("div",{children:"Limit:"}),(0,l.jsx)(c.d,{"aria-label":"Page Size",defaultSelectedKeys:["10"],label:"",onChange:e=>{let{target:{value:t}}=e;return Q(t)},children:W.map(e=>(0,l.jsx)(d.y,{children:e.label},e.key))})]}),(0,l.jsx)(u.T,{showControls:!0,initialPage:1,page:y,total:N,onChange:e=>{S(e)}})]}),(0,l.jsxs)(m.j,{"aria-label":"Jobs table",bottomContent:N>0?(0,l.jsx)("div",{className:"flex w-full justify-center",children:(0,l.jsx)(u.T,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",page:y,total:N,onChange:e=>S(e)})}):null,sortDescriptor:L,onSortChange:K,children:[(0,l.jsxs)(h.X,{children:[(0,l.jsx)(x.e,{children:"UPI Content"},"file_content"),(0,l.jsx)(x.e,{allowsSorting:!0,children:"Worker"},"worker_id"),(0,l.jsx)(x.e,{allowsSorting:!0,children:"Status"},"status"),(0,l.jsx)(x.e,{children:"Logs"},"logs"),(0,l.jsx)(x.e,{children:"Result"},"result"),(0,l.jsx)(x.e,{children:"Duration"},"duration"),(0,l.jsx)(x.e,{children:"created_at"},"timestamps.created_at"),(0,l.jsx)(x.e,{children:"assigned_at"},"timestamps.assigned_at"),(0,l.jsx)(x.e,{children:"completed_at"},"timestamps.completed_at")]}),(0,l.jsx)(f.E,{items:null!=V?V:[],loadingContent:(0,l.jsx)(p.o,{}),loadingState:e?"loading":"idle",children:e=>(0,l.jsx)(g.s,{children:t=>(0,l.jsx)(j.w,{children:G(e,t)})},e.job_id)})]}),(0,l.jsx)(b.Y,{backdrop:"blur",isOpen:B,scrollBehavior:"inside",size:"5xl",onClose:()=>{A(!1),R(""),U("")},children:(0,l.jsxs)(_.g,{children:[(0,l.jsx)(w.c,{className:"flex flex-col gap-1",children:J}),(0,l.jsx)(v.h,{children:(0,l.jsx)("div",{className:"whitespace-pre-wrap",children:z})})]})}),(0,l.jsx)(b.Y,{backdrop:"blur",isOpen:Y,scrollBehavior:"inside",size:"4xl",onClose:()=>{I(!1),M([])},children:(0,l.jsxs)(_.g,{children:[(0,l.jsx)(w.c,{className:"flex flex-col gap-1",children:"Logs"}),(0,l.jsx)(v.h,{children:(0,l.jsx)("div",{className:"whitespace-pre-wrap",children:P&&P.length>0&&P.map((e,t)=>(0,l.jsx)("div",{children:e},e+t))})})]})})]})}},94235:(e,t,s)=>{s.d(t,{oO:()=>r,CQ:()=>l});let l={name:"PioSolver Dashboard",description:"PioSolver Dashboard",navItems:[{label:"Job",href:"/job"},{label:"Worker",href:"/worker"},{label:"User Input",href:"/input"}],navMenuItems:[{label:"Job",href:"/job"},{label:"Worker",href:"/worker"},{label:"User Input",href:"/input"}],links:{}},r={wsBaseURL:"ws://localhost:9000/ws"}}}]);