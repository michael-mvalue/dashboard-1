(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5305:(e,r,t)=>{Promise.resolve().then(t.bind(t,41057))},31294:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var s=t(95155),l=t(30832),a=t.n(l),n=t(12115),o=t(64184),i=t(52863),c=t(94161),d=t(75584),u=t(33061),h=t(56201),f=t(15354),x=t(65676),g=t(36115),w=t(41479),j=t(40400),m=t(55753),p=t(59581),b=t(51362),k=t(53999);function S(e){let{value:r}=e,{resolvedTheme:t}=(0,b.D)(),l="dark"===t?"flat":"solid";return(0,s.jsx)("span",{className:"flex justify-center items-center",children:"idle"===r?(0,s.jsx)(p.R,{className:"gap-1 text-white",color:"success",variant:l,children:(0,k.b)(r)}):"busy"===r?(0,s.jsx)(p.R,{className:"gap-1 text-white",color:"danger",variant:"shadow",children:(0,k.b)(r)}):(0,s.jsx)(p.R,{className:"gap-1 text-white",variant:l,children:(0,k.b)(r)})})}var y=t(31280);let N=t(94235).oO.wsBaseURL,_=[{key:10,label:"10"},{key:20,label:"20"},{key:50,label:"50"},{key:100,label:"100"}];function v(){let[e,r]=(0,n.useState)(!0),[t,l]=(0,n.useState)([]),[p,b]=(0,n.useState)(1),[k,v]=(0,n.useState)(0),[C,E]=(0,n.useState)(5),[W,R]=(0,n.useState)({column:"worker_id",direction:"ascending"}),O=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=new WebSocket("".concat(N,"/worker"));return O.current=e,e.onopen=()=>{console.log("âœ… Worker WebSocket connected"),r(!0),e.send(JSON.stringify({page:p,limit:C}))},e.onmessage=e=>{try{let{type:r,payload:t}=JSON.parse(e.data);if(r===y.u.WORKER_INIT||r===y.u.WORKER_FETCH_NEW){let{data:e,pagination:r}=t;if(!Array.isArray(e))throw console.error("data:: ",e),Error("Invalid job data");l(e),b(r.currentPage),v(r.totalPages)}r===y.u.WORKER_UPDATE&&l(e=>{let r=new Map(e.map(e=>[e.worker_id,e])),s=[];for(let e of t)r.has(e.worker_id)&&s.push(e);return[...e.map(e=>s.find(r=>r.worker_id===e.worker_id)||e)].slice(0,C)})}catch(e){console.error("Failed to parse message",e)}r(!1)},e.onerror=e=>console.error("WebSocket error:",e),e.onclose=()=>console.warn("WebSocket connection closed"),()=>e.close()},[C]);let P=(0,n.useMemo)(()=>{let{column:e,direction:r}=W;return Array.isArray(t)&&null!==t?[...t].sort((t,s)=>{let l=t[e],a=s[e];if(null==l)return"ascending"===r?1:-1;if(null==a)return"ascending"===r?-1:1;let n="string"==typeof l?l.toLowerCase():l,o="string"==typeof a?a.toLowerCase():a;return n<o?"ascending"===r?-1:1:n>o?"ascending"===r?1:-1:0}):[]},[t,W]),A=e=>{E(parseInt(e))};(0,n.useEffect)(()=>{O.current&&O.current.readyState===WebSocket.OPEN&&(r(!0),O.current.send(JSON.stringify({page:p,limit:C})))},[p,C]);let D=(0,n.useCallback)((e,r)=>{switch(r){case"status":return(0,s.jsx)(S,{value:e.status});case"last_heartbeat":return(0,s.jsx)("div",{children:a()(e.last_heartbeat).format("hh:mm:ss A")});default:return(0,o.fm)(e,r)}},[]);return(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsx)("h1",{className:(0,m.D)(),children:"Worker"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 min-w-[160px]",children:[(0,s.jsx)("div",{children:"Limit:"}),(0,s.jsx)(i.d,{"aria-label":"Page Size",defaultSelectedKeys:["10"],label:"",onChange:e=>{let{target:{value:r}}=e;return A(r)},children:_.map(e=>(0,s.jsx)(c.y,{children:e.label},e.key))})]}),(0,s.jsx)(d.T,{showControls:!0,initialPage:1,page:p,total:k,onChange:e=>{b(e)}})]}),(0,s.jsxs)(u.j,{"aria-label":"Jobs table",bottomContent:k>0?(0,s.jsx)("div",{className:"flex w-full justify-center",children:(0,s.jsx)(d.T,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",page:p,total:k,onChange:e=>b(e)})}):null,sortDescriptor:W,onSortChange:R,children:[(0,s.jsxs)(h.X,{children:[(0,s.jsx)(f.e,{allowsSorting:!0,children:"Worker ID"},"worker_id"),(0,s.jsx)(f.e,{allowsSorting:!0,children:"Worker Status"},"status"),(0,s.jsx)(f.e,{allowsSorting:!0,children:"Last Heartbeat"},"last_heartbeat")]}),(0,s.jsx)(x.E,{items:null!=P?P:[],loadingContent:(0,s.jsx)(g.o,{}),loadingState:e?"loading":"idle",children:e=>(0,s.jsx)(w.s,{children:r=>(0,s.jsx)(j.w,{children:D(e,r)})},e.worker_id)})]})]})}},41057:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>n});var s=t(95155),l=t(63463),a=t(31294);function n(){return(0,s.jsxs)("section",{className:"h-full w-full flex flex-col lg:flex-row gap-4 pt-8",children:[(0,s.jsx)("div",{className:"flex w-full lg:w-3/4 flex-col",children:(0,s.jsx)(l.default,{})}),(0,s.jsx)("div",{className:"w-full lg:w-1/4 flex flex-col",children:(0,s.jsx)(a.default,{})})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[711,471,894,589,90,995,911,463,441,684,358],()=>r(5305)),_N_E=e.O()}]);